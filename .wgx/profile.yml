---
# WGX Profil für hauski-audio
profile: hauski-audio
description: "Local audio orchestration layer"
wgx-version: ">=2.0.0"

class: rust-python-hybrid

lang:
  - rust
  - python
  - shell

meta:
  org: heimgewebe
  repo: alexdermohr/hauski-audio
  maintainer: alexdermohr@gmail.com
  tags:
    - audio
    - motu
    - qobuz
    - hauski
    - wgx
  ci: true

rust:
  toolchain: stable

python:
  uv: true

tool:
  uv:
    sync: true

env:
  UV_SYSTEM_PYTHON: "1"
  PIP_DISABLE_PIP_VERSION_CHECK: "1"
  RUSTFLAGS: "-C debuginfo=0"
  PYTHONUNBUFFERED: "1"
  UV_PIP_VERSION: "24.0"

tasks:
  smoke: |
    echo "[wgx.smoke] hauski-audio – schneller Grundcheck"
    cargo build --workspace --quiet
    if command -v uv >/dev/null 2>&1 && [ -f pyproject.toml ]; then
      uv run python -c "print('python smoke ok')" || true
    fi

  guard: |
    echo "[wgx.guard] Rust & Python streng prüfen…"
    cargo fmt --all --check
    cargo clippy --all-targets --all-features -- -D warnings
    if command -v uv >/dev/null 2>&1 && [ -f pyproject.toml ]; then
      uv sync --frozen || uv sync
      uv run ruff check .
      uv run pytest --maxfail=1 --disable-warnings
    else
      echo "[wgx.guard] uv/pyproject nicht vorhanden – Python-Checks übersprungen."
    fi

  metrics: |
    echo "[wgx.metrics] einfache Coverage-Metrik (best effort)…"
    if command -v cargo-llvm-cov >/dev/null 2>&1; then
      cargo llvm-cov --workspace --lcov --output-path lcov.info || true
    else
      echo "cargo-llvm-cov nicht installiert – skip."
    fi
    if command -v uv >/dev/null 2>&1 && [ -f pyproject.toml ]; then
      uv run pytest --cov=hauski_audio --cov-report=term-missing || true
    fi

  snapshot: |
    echo "[wgx.snapshot] Build + Tests (best effort)…"
    cargo test --workspace || true
    if command -v uv >/dev/null 2>&1 && [ -f pyproject.toml ]; then
      uv run pytest || true
    fi
